---
  chain:
    -
      name: "git_clone"
      ref: "cicd-docker.git_simple_clone"
      params:
        repo: "{{git_repo}}"
        target: "{{target}}"
        hosts: "localhost"
      on-success: "build_docker_image"
      on-failure: "notify_clone_error_slack"
    -
      name: "build_docker_image"
      ref: "cicd-docker.build_image"
      params:
        dockerfile_path: "{{target}}/"
        tag: "{{docker_image_tag}}"
      on-success: "push_docker_image"
    -
      name: "push_docker_image"
      ref: "cicd-docker.push_image"
      params:
        repo: "{{docker_registry_repo}}"
      on-success: "notify_image_pushed_slack"
      # clean repo.
    -
      name: "notify_image_pushed_slack"
      ref: "slack.post_message"
      params:
        message: "Docker image pushed for `{{project}}/{{branch}}`..."
        channel: "#lakshmi"
    -
      name: "notify_clone_error_slack"
      ref: "slack.post_message"
      params:
        message: "Clone failed  for `{{project}}/{{branch}}`..."
        channel: "#lakshmi"

  default: git_clone
