---
  chain:
    -
      name: "check_dir_size"
      ref: "st2-demos.check_dir_size"
      params:
        hostname: "{{hostname}}"
        directory: "{{directory}}"
        threshold: "{{threshold}}"
      on-success: "pager_duty_escalation"
      on-failure: "remove_files"
    -
      name: "remove_files"
      ref: "core.remote_sudo"
      params:
        hosts: "{{hostname}}"
        cmd: "rm -Rf {{directory}}/*{{file_extension}}"
      on-success: "validate_dir_size"
      on-failure: "pager_duty_escalation"
    -
      name: "validate_dir_size"
      ref: "st2-demos.check_dir_size"
      params:
        hostname: "{{hostname}}"
        directory: "{{directory}}"
        threshold: "{{threshold}}"
      on-success: "post_success_to_slack"
      on-failure: "pager_duty_escalation"
    -
      name: "post_success_to_slack"
      ref: "slack.chat.postMessage"
      params:
        channel: "#demos"
        text: "DemoBot has pruned {{directory}} on {{hostname}} due to a monitoring event.  ID: {{event_id}}"
    -
      name: "pager_duty_escalation"
      ref: "pagerduty.launch_incident"
      params:
        details: "{{raw_payload}}"
        description: "Diskspace Event {{hostname}}"
  default: "check_dir_size"